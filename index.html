<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ë¬´ë£Œ ì°¨íŠ¸ ìƒì„±ê¸°. Line, Bar, Pie, Doughnut ì°¨íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“œì„¸ìš”. CSV ë°ì´í„° ì§€ì›. PNG ë‹¤ìš´ë¡œë“œ.">
    <meta name="keywords" content="ì°¨íŠ¸ ìƒì„±ê¸°, ê·¸ë˜í”„ ë§Œë“¤ê¸°, ë°ì´í„° ì‹œê°í™”, ë¬´ë£Œ ì°¨íŠ¸, CSV ì°¨íŠ¸, ë§‰ëŒ€ ê·¸ë˜í”„, ì›í˜• ê·¸ë˜í”„">
    <meta name="author" content="BAAL">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chart.baal.co.kr/">
    <meta property="og:title" content="ì°¨íŠ¸ ìƒì„±ê¸° - ë¬´ë£Œ ì˜¨ë¼ì¸ ë„êµ¬">
    <meta property="og:description" content="Line, Bar, Pie ì°¨íŠ¸ë¥¼ ë¬´ë£Œë¡œ ìƒì„±í•˜ì„¸ìš”. CSV ì§€ì›, PNG ë‹¤ìš´ë¡œë“œ.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://chart.baal.co.kr/">
    <meta property="twitter:title" content="ì°¨íŠ¸ ìƒì„±ê¸° - ë¬´ë£Œ ì˜¨ë¼ì¸ ë„êµ¬">
    <meta property="twitter:description" content="ë°ì´í„° ì‹œê°í™” ì°¨íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“œì„¸ìš”.">

    <title>ì°¨íŠ¸ ìƒì„±ê¸° - BAAL</title>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2886185075996969"
     crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="_common/common.css">
    <style>
        /* ì°¨íŠ¸ íƒ€ì… ì„ íƒ */
        .chart-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
        }

        .chart-type-btn {
            padding: 20px 16px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
        }

        .chart-type-btn:hover {
            border-color: var(--gold-primary);
            background: var(--bg-accent);
        }

        .chart-type-btn.active {
            background: var(--gold-gradient);
            color: white;
            border-color: var(--gold-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .chart-icon {
            font-size: 2em;
            display: block;
            margin-bottom: 8px;
        }

        /* ë°ì´í„° ì…ë ¥ */
        .data-section {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 25px;
        }

        .data-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 10px;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .data-table th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 600;
        }

        .data-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .add-row-btn {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .add-row-btn:hover {
            border-color: var(--gold-primary);
            background: var(--bg-accent);
        }

        /* ì°¨íŠ¸ ìº”ë²„ìŠ¤ */
        .chart-container {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 25px;
            position: relative;
        }

        #chartCanvas {
            max-width: 100%;
            height: auto;
        }

        /* ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ */
        .options-section {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 25px;
        }

        .option-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .option-row:last-child {
            margin-bottom: 0;
        }

        .option-label {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 100px;
            font-size: 0.95em;
        }

        .option-control {
            flex: 1;
        }

        .option-select {
            padding: 10px 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1em;
            cursor: pointer;
        }

        /* ë²„íŠ¼ */
        .btn-generate {
            padding: 16px 48px;
            background: var(--gold-gradient);
            color: white;
            border: 2px solid var(--gold-primary);
            border-radius: var(--border-radius-md);
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            display: block;
            margin: 0 auto;
        }

        .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-download {
            padding: 14px 32px;
            background: var(--gold-gradient);
            color: white;
            border: 2px solid var(--gold-primary);
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .download-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .chart-types {
                grid-template-columns: repeat(2, 1fr);
            }

            .option-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .option-label {
                min-width: auto;
            }

            .option-control {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
    <div class="theme-toggle">
        <button id="themeToggle" aria-label="ë‹¤í¬ëª¨ë“œ ì „í™˜">
            <span class="icon-light">â˜€ï¸</span>
            <span class="icon-dark">ğŸŒ™</span>
        </button>
    </div>

    <!-- ì–¸ì–´ ì „í™˜ & ë„êµ¬ ë²„íŠ¼ -->
    <div class="lang-toggle">
        <button id="langToggle" data-lang="ko">
            <span class="lang-ko">EN</span>
            <span class="lang-en">KO</span>
        </button>
        <button id="toolsToggle">
            <span class="tooltip" data-ko="ë” ë§ì€ ë„êµ¬" data-en="More Tools">ë” ë§ì€ ë„êµ¬</span>
            ğŸ§°
        </button>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <header>
            <h1 data-ko="ì°¨íŠ¸ ìƒì„±ê¸°" data-en="Chart Generator">ì°¨íŠ¸ ìƒì„±ê¸°</h1>
            <p class="subtitle" data-ko="ë°ì´í„°ë¥¼ ì•„ë¦„ë‹¤ìš´ ì°¨íŠ¸ë¡œ ì‹œê°í™”í•˜ì„¸ìš”" data-en="Visualize your data with beautiful charts">ë°ì´í„°ë¥¼ ì•„ë¦„ë‹¤ìš´ ì°¨íŠ¸ë¡œ ì‹œê°í™”í•˜ì„¸ìš”</p>
        </header>

        <main>
            <!-- ğŸ“Š ì°¨íŠ¸ íƒ€ì… ì„ íƒ -->
            <div class="data-section">
                <label class="data-label">
                    <span data-ko="ğŸ“Š ì°¨íŠ¸ íƒ€ì… ì„ íƒ" data-en="ğŸ“Š Select Chart Type">ğŸ“Š ì°¨íŠ¸ íƒ€ì… ì„ íƒ</span>
                </label>
                <div class="chart-types">
                    <button class="chart-type-btn active" data-type="line">
                        <span class="chart-icon">ğŸ“ˆ</span>
                        <span data-ko="ì„  ê·¸ë˜í”„" data-en="Line Chart">ì„  ê·¸ë˜í”„</span>
                    </button>
                    <button class="chart-type-btn" data-type="bar">
                        <span class="chart-icon">ğŸ“Š</span>
                        <span data-ko="ë§‰ëŒ€ ê·¸ë˜í”„" data-en="Bar Chart">ë§‰ëŒ€ ê·¸ë˜í”„</span>
                    </button>
                    <button class="chart-type-btn" data-type="pie">
                        <span class="chart-icon">ğŸ¥§</span>
                        <span data-ko="ì›í˜• ê·¸ë˜í”„" data-en="Pie Chart">ì›í˜• ê·¸ë˜í”„</span>
                    </button>
                    <button class="chart-type-btn" data-type="doughnut">
                        <span class="chart-icon">ğŸ©</span>
                        <span data-ko="ë„ë„› ê·¸ë˜í”„" data-en="Doughnut">ë„ë„› ê·¸ë˜í”„</span>
                    </button>
                    <button class="chart-type-btn" data-type="radar">
                        <span class="chart-icon">ğŸ¯</span>
                        <span data-ko="ë°©ì‚¬í˜•" data-en="Radar">ë°©ì‚¬í˜•</span>
                    </button>
                    <button class="chart-type-btn" data-type="polarArea">
                        <span class="chart-icon">â­•</span>
                        <span data-ko="ê·¹ì¢Œí‘œ" data-en="Polar Area">ê·¹ì¢Œí‘œ</span>
                    </button>
                </div>
            </div>

            <!-- ğŸ“ ë°ì´í„° ì…ë ¥ -->
            <div class="data-section">
                <label class="data-label">
                    <span data-ko="ğŸ“ ë°ì´í„° ì…ë ¥" data-en="ğŸ“ Enter Data">ğŸ“ ë°ì´í„° ì…ë ¥</span>
                </label>
                <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <input type="file" id="csvInput" accept=".csv" style="display: none;">
                    <div>
                        <small style="color: var(--text-secondary);" data-ko="CSV í˜•ì‹: ì²« í–‰ ë ˆì´ë¸”, ì´í›„ í–‰ ë°ì´í„°" data-en="CSV format: First row labels, then data rows">CSV í˜•ì‹: ì²« í–‰ ë ˆì´ë¸”, ì´í›„ í–‰ ë°ì´í„°</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="add-row-btn" id="csvUploadBtn" data-ko="ğŸ“„ CSV ì—…ë¡œë“œ" data-en="ğŸ“„ Upload CSV">ğŸ“„ CSV ì—…ë¡œë“œ</button>
                        <button class="add-row-btn" id="addRowBtn" data-ko="â• í–‰ ì¶”ê°€" data-en="â• Add Row">â• í–‰ ì¶”ê°€</button>
                        <button class="add-row-btn" id="deleteRowBtn" data-ko="ğŸ—‘ï¸ ì„ íƒí–‰ ì‚­ì œ" data-en="ğŸ—‘ï¸ Delete Selected" style="background: rgba(255, 68, 68, 0.1); border-color: #ff4444; color: #ff4444;">ğŸ—‘ï¸ ì„ íƒí–‰ ì‚­ì œ</button>
                    </div>
                </div>
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th style="width: 40px;"><input type="checkbox" id="selectAllCheckbox" style="width: auto; cursor: pointer;"></th>
                            <th data-ko="ë ˆì´ë¸”" data-en="Label">ë ˆì´ë¸”</th>
                            <th data-ko="ê°’" data-en="Value">ê°’</th>
                        </tr>
                    </thead>
                    <tbody id="dataRows">
                        <tr>
                            <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                            <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" data-row="0" data-col="label"></td>
                            <td><input type="number" placeholder="ê°’ ì…ë ¥" data-row="0" data-col="value"></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                            <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" data-row="1" data-col="label"></td>
                            <td><input type="number" placeholder="ê°’ ì…ë ¥" data-row="1" data-col="value"></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                            <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" data-row="2" data-col="label"></td>
                            <td><input type="number" placeholder="ê°’ ì…ë ¥" data-row="2" data-col="value"></td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                            <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" data-row="3" data-col="label"></td>
                            <td><input type="number" placeholder="ê°’ ì…ë ¥" data-row="3" data-col="value"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ğŸ¨ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜µì…˜ -->
            <div class="options-section">
                <label class="data-label">
                    <span data-ko="ğŸ¨ ì»¤ìŠ¤í„°ë§ˆì´ì§• (ì„ íƒì‚¬í•­)" data-en="ğŸ¨ Customization (Optional)">ğŸ¨ ì»¤ìŠ¤í„°ë§ˆì´ì§• (ì„ íƒì‚¬í•­)</span>
                </label>

                <div class="option-row">
                    <span class="option-label" data-ko="ìƒ‰ìƒ íŒ”ë ˆíŠ¸" data-en="Color Palette">ìƒ‰ìƒ íŒ”ë ˆíŠ¸</span>
                    <div class="option-control">
                        <select class="option-select" id="colorPalette">
                            <option value="default" data-ko="ê¸°ë³¸" data-en="Default">ê¸°ë³¸</option>
                            <option value="pastel" data-ko="íŒŒìŠ¤í…”" data-en="Pastel">íŒŒìŠ¤í…”</option>
                            <option value="vivid" data-ko="ë¹„ë¹„ë“œ" data-en="Vivid">ë¹„ë¹„ë“œ</option>
                            <option value="gold" data-ko="ê³¨ë“œ" data-en="Gold">ê³¨ë“œ</option>
                        </select>
                    </div>
                </div>

                <div class="option-row">
                    <span class="option-label" data-ko="ë²”ë¡€ ìœ„ì¹˜" data-en="Legend Position">ë²”ë¡€ ìœ„ì¹˜</span>
                    <div class="option-control">
                        <select class="option-select" id="legendPosition">
                            <option value="top" data-ko="ìƒë‹¨" data-en="Top">ìƒë‹¨</option>
                            <option value="bottom" data-ko="í•˜ë‹¨" data-en="Bottom">í•˜ë‹¨</option>
                            <option value="left" data-ko="ì™¼ìª½" data-en="Left">ì™¼ìª½</option>
                            <option value="right" data-ko="ì˜¤ë¥¸ìª½" data-en="Right">ì˜¤ë¥¸ìª½</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ìƒì„± ë²„íŠ¼ -->
            <div style="margin: 30px 0; text-align: center;">
                <button class="btn-generate" id="generateBtn" data-ko="ì°¨íŠ¸ ìƒì„±" data-en="Generate Chart">ì°¨íŠ¸ ìƒì„±</button>
            </div>

            <!-- 4ï¸âƒ£ ì°¨íŠ¸ ë¯¸ë¦¬ë³´ê¸° -->
            <div class="chart-container">
                <canvas id="chartCanvas"></canvas>
            </div>

            <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
            <div class="download-buttons">
                <button class="btn-download" id="downloadPNG" data-ko="PNG ë‹¤ìš´ë¡œë“œ" data-en="Download PNG">PNG ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <p class="footer-brand">
                    Made by <a href="https://baal.co.kr" target="_blank">BAAL</a>
                </p>
                <p class="footer-contact">
                    <a href="mailto:baal.contract@gmail.com">baal.contract@gmail.com</a>
                </p>
                <p class="footer-links">
                    <a href="https://baal.co.kr/privacy" target="_blank" data-ko="ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨" data-en="Privacy Policy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                    <span class="separator">|</span>
                    <a href="https://baal.co.kr/terms" target="_blank" data-ko="ì´ìš©ì•½ê´€" data-en="Terms of Service">ì´ìš©ì•½ê´€</a>
                </p>
                <p class="footer-copyright">&copy; 2025 BAAL. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="_common/common.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
        window.scrollTo(0, 0);

        let currentChartType = 'line';
        let chartInstance = null;

        // ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        const colorPalettes = {
            default: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)'
            ],
            pastel: [
                'rgba(255, 179, 186, 0.7)',
                'rgba(186, 225, 255, 0.7)',
                'rgba(255, 223, 186, 0.7)',
                'rgba(186, 255, 201, 0.7)',
                'rgba(226, 186, 255, 0.7)',
                'rgba(255, 223, 186, 0.7)'
            ],
            vivid: [
                'rgba(255, 0, 0, 0.7)',
                'rgba(0, 0, 255, 0.7)',
                'rgba(255, 255, 0, 0.7)',
                'rgba(0, 255, 0, 0.7)',
                'rgba(255, 0, 255, 0.7)',
                'rgba(0, 255, 255, 0.7)'
            ],
            gold: [
                'rgba(212, 175, 55, 0.7)',
                'rgba(218, 165, 32, 0.7)',
                'rgba(184, 134, 11, 0.7)',
                'rgba(255, 215, 0, 0.7)',
                'rgba(238, 232, 170, 0.7)',
                'rgba(189, 183, 107, 0.7)'
            ]
        };

        // íƒ€ì… ì„ íƒ
        document.querySelectorAll('.chart-type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentChartType = btn.dataset.type;
                document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // í–‰ ì¶”ê°€
        document.getElementById('addRowBtn').addEventListener('click', () => {
            const tbody = document.getElementById('dataRows');
            const rowCount = tbody.children.length;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                <td><input type="text" placeholder="í•­ëª©ëª… ì…ë ¥" data-row="${rowCount}" data-col="label"></td>
                <td><input type="number" placeholder="ê°’ ì…ë ¥" data-row="${rowCount}" data-col="value"></td>
            `;
            tbody.appendChild(newRow);
        });

        // ì„ íƒí–‰ ì‚­ì œ
        document.getElementById('deleteRowBtn').addEventListener('click', () => {
            const checkboxes = document.querySelectorAll('.row-checkbox:checked');

            if (checkboxes.length === 0) {
                window.BaalUtils.showToast('ì‚­ì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”.', 'error', 5000);
                return;
            }

            checkboxes.forEach(checkbox => {
                checkbox.closest('tr').remove();
            });

            window.BaalUtils.showToast(`${checkboxes.length}ê°œ í–‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success', 5000);
        });

        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
        document.getElementById('selectAllCheckbox').addEventListener('change', (e) => {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        });

        // CSV ì—…ë¡œë“œ
        document.getElementById('csvUploadBtn').addEventListener('click', () => {
            document.getElementById('csvInput').click();
        });

        document.getElementById('csvInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const lines = text.split('\n').filter(line => line.trim());

                if (lines.length < 2) {
                    window.BaalUtils.showToast('CSV íŒŒì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error', 5000);
                    return;
                }

                // í…Œì´ë¸” ì´ˆê¸°í™”
                const tbody = document.getElementById('dataRows');
                tbody.innerHTML = '';

                // ì²« í–‰ì€ ê±´ë„ˆë›°ê³  (ë ˆì´ë¸”), ë°ì´í„° í–‰ë§Œ íŒŒì‹±
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    if (values.length >= 2) {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td><input type="checkbox" class="row-checkbox" style="width: auto; cursor: pointer;"></td>
                            <td><input type="text" value="${values[0]}" data-row="${i-1}" data-col="label"></td>
                            <td><input type="number" value="${parseFloat(values[1]) || 0}" data-row="${i-1}" data-col="value"></td>
                        `;
                        tbody.appendChild(newRow);
                    }
                }

                window.BaalUtils.showToast(`CSV íŒŒì¼ ë¡œë“œ ì™„ë£Œ! (${lines.length - 1}ê°œ í–‰)`, 'success', 5000);

                // ìë™ìœ¼ë¡œ ì°¨íŠ¸ ìƒì„±
                setTimeout(() => generateChart(), 500);

            } catch (error) {
                console.error('CSV parse error:', error);
                window.BaalUtils.showToast('CSV íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + error.message, 'error', 5000);
            }
        });

        // ì°¨íŠ¸ ìƒì„±
        document.getElementById('generateBtn').addEventListener('click', () => {
            generateChart();
        });

        function generateChart() {
            const rows = Array.from(document.querySelectorAll('#dataRows tr'));
            const labels = [];
            const data = [];

            rows.forEach(row => {
                const labelInput = row.querySelector('[data-col="label"]');
                const valueInput = row.querySelector('[data-col="value"]');

                if (labelInput && valueInput) {
                    labels.push(labelInput.value || 'í•­ëª©');
                    data.push(parseFloat(valueInput.value) || 0);
                }
            });

            if (data.length === 0) {
                window.BaalUtils.showToast('ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error', 5000);
                return;
            }

            const palette = document.getElementById('colorPalette').value;
            const legendPosition = document.getElementById('legendPosition').value;

            const colors = colorPalettes[palette];
            const backgroundColors = data.map((_, i) => colors[i % colors.length]);
            const borderColors = backgroundColors.map(c => c.replace('0.7', '1'));

            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (chartInstance) {
                chartInstance.destroy();
            }

            const ctx = document.getElementById('chartCanvas').getContext('2d');

            chartInstance = new Chart(ctx, {
                type: currentChartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë°ì´í„°',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: legendPosition,
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-primary').trim()
                            }
                        }
                    },
                    scales: (currentChartType === 'pie' || currentChartType === 'doughnut' || currentChartType === 'polarArea') ? {} : {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary').trim()
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-secondary').trim()
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });

            window.BaalUtils.showToast('ì°¨íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 5000);
        }

        // PNG ë‹¤ìš´ë¡œë“œ
        document.getElementById('downloadPNG').addEventListener('click', () => {
            if (!chartInstance) {
                window.BaalUtils.showToast('ë¨¼ì € ì°¨íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'error', 5000);
                return;
            }

            const canvas = document.getElementById('chartCanvas');
            canvas.toBlob((blob) => {
                window.BaalUtils.downloadFile(blob, 'chart.png');
                window.BaalUtils.showToast('PNG ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success', 5000);
            }, 'image/png');
        });
    </script>
</body>
</html>
